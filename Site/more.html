<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Detail - PMR Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        body {
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='3.5' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' /%3E%3C/svg%3E");
            z-index: 1;
        }
        
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(120px);
            pointer-events: none;
            z-index: 0;
        }
        
        .orb-1 {
            top: 0;
            right: 0;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(0,26,61,0.6) 0%, transparent 70%);
        }
        
        .orb-2 {
            bottom: 0;
            left: 0;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0,212,255,0.2) 0%, transparent 70%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        
        .glass:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #ffffff 0%, #00d4ff 50%, #00ff88 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, rgba(0,26,61,0.4) 0%, rgba(0,65,112,0.2) 100%);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .slide-in { animation: slideIn 0.6s ease-out forwards; }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(0,212,255,0.1) 0%, rgba(0,255,136,0.05) 100%);
            border: 1px solid rgba(0,212,255,0.2);
        }
    </style>
</head>
<body>
    <div class="grain"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    
    <div class="relative z-10 max-w-[1600px] mx-auto px-4 sm:px-6 py-8">
        <!-- Back button -->
        <button onclick="window.history.back()" class="glass px-4 py-2 rounded-lg flex items-center gap-2 mb-8 hover:scale-105 transition-transform">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <span>Retour</span>
        </button>

        <!-- HEADER STYLE DASHBOARD -->
        <div class="mb-10 slide-in">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-3">
                    <span class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider">Ligue 1</span>
                    <span class="glass px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider text-red-400 border-red-500/30">Le Classique</span>
                </div>
                <div class="flex items-center gap-2 pulse">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span class="text-xs text-green-400 font-semibold uppercase tracking-wider">Live</span>
                </div>
            </div>
            
            <div class="grid lg:grid-cols-12 gap-6 items-center">
                <!-- Titre -->
                <div class="lg:col-span-7">
                    <h1 class="text-5xl lg:text-7xl font-black mb-6 leading-tight">
                        <span class="gradient-text">PSG</span>
                        <span class="text-gray-600 mx-3">vs</span>
                        <span class="gradient-text">OM</span>
                    </h1>
                    <div class="flex flex-wrap items-center gap-4 text-sm text-gray-400">
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span>Dimanche 15 Janvier 2025</span>
                        </div>
                        <span class="text-gray-700">‚Ä¢</span>
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>21:00</span>
                        </div>
                        <span class="text-gray-700">‚Ä¢</span>
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            </svg>
                            <span>Parc des Princes</span>
                        </div>
                    </div>
                </div>
                
                <!-- Status PMR Card -->
                <div class="lg:col-span-5">
                    <div class="glass rounded-2xl p-6 border-l-4 border-red-500/50">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-xs text-gray-400 uppercase tracking-wider mb-1">Places PMR</div>
                                <div class="text-3xl font-black text-red-400 mb-1">Aucune</div>
                                <div class="text-xs text-gray-500">Derni√®re v√©rif: il y a 3 min</div>
                            </div>
                            <div class="text-5xl">‚ùå</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GRID PRINCIPALE -->
        <div class="grid lg:grid-cols-12 gap-6">
            <!-- COLONNE GAUCHE - 8 cols -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Indice IA -->
                <div class="glass rounded-3xl p-8 slide-in" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-black mb-2">Indice d'anticipation</h2>
                            <p class="text-sm text-gray-400 uppercase tracking-wider">Analyse IA temps r√©el</p>
                        </div>
                        <span class="stat-card px-4 py-2 rounded-xl text-sm font-bold uppercase tracking-wider">IA</span>
                    </div>
                    
                    <div class="grid sm:grid-cols-3 gap-6 mb-8">
                        <div class="text-center">
                            <div class="text-7xl font-black gradient-text mb-2">94%</div>
                            <div class="text-sm text-gray-400 uppercase tracking-wider">Hype Level</div>
                        </div>
                        <div class="stat-card p-6 rounded-2xl text-center">
                            <div class="text-4xl mb-2">üî•</div>
                            <div class="text-2xl font-bold mb-1">Tr√®s √©lev√©</div>
                            <div class="text-xs text-gray-400">Hype social</div>
                        </div>
                        <div class="stat-card p-6 rounded-2xl text-center">
                            <div class="text-4xl mb-2">üë•</div>
                            <div class="text-2xl font-bold mb-1">98%</div>
                            <div class="text-xs text-gray-400">Affluence pr√©vue</div>
                        </div>
                    </div>
                    
                    <div class="gradient-bg border border-cyan-500/20 rounded-2xl p-6">
                        <div class="flex items-start gap-4">
                            <div class="text-4xl">ü§ñ</div>
                            <div>
                                <div class="font-bold text-cyan-300 mb-2 text-lg">Analyse IA</div>
                                <p class="text-gray-300 leading-relaxed">
                                    Le Classique PSG-OM est l'affiche la plus attendue de Ligue 1. Avec un taux d'anticipation de 94% et une affluence pr√©vue de 98%, la demande est exceptionnelle. Historique : seulement 3 places PMR lib√©r√©es sur les 6 derniers Classiques. <span class="text-white font-semibold">Probabilit√© de disponibilit√© : 12%</span>. Recommandation : activer alertes Telegram.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphique -->
                <div class="glass rounded-3xl p-8 slide-in" style="animation-delay: 0.2s">
                    <h2 class="text-2xl font-black mb-6">Historique des v√©rifications</h2>
                    <div class="w-full" style="height: 300px;">
                        <canvas id="checkChart"></canvas>
                    </div>
                </div>

                <!-- Comparaison matchs -->
                <div class="glass rounded-3xl p-8 slide-in" style="animation-delay: 0.3s">
                    <h2 class="text-2xl font-black mb-6">Comparaison avec autres matchs</h2>
                    <div class="space-y-4 comparison-container">
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-semibold">PSG vs OM</span>
                                <span class="font-black text-cyan-400">94%</span>
                            </div>
                            <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan-500 to-green-500" style="width: 94%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-semibold">PSG vs Lyon</span>
                                <span class="font-black">82%</span>
                            </div>
                            <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan-500 to-blue-500" style="width: 82%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-semibold">PSG vs Monaco</span>
                                <span class="font-black">76%</span>
                            </div>
                            <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500" style="width: 76%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-semibold">PSG vs Lens</span>
                                <span class="font-black">61%</span>
                            </div>
                            <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500" style="width: 61%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historique d√©tections -->
                <div class="glass rounded-3xl p-8 slide-in" style="animation-delay: 0.4s">
                    <h2 class="text-2xl font-black mb-6">Historique des d√©tections</h2>
                    <div id="detections-history" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-4xl mb-2">‚è≥</div>
                            <div>Chargement de l'historique...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLONNE DROITE - 4 cols -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Stats monitoring -->
                <div class="glass rounded-3xl p-6 slide-in" style="animation-delay: 0.2s">
                    <h3 class="text-xl font-black mb-6">Stats Monitoring</h3>
                    <div class="space-y-4">
                        <div class="stat-card p-5 rounded-xl">
                            <div class="text-xs text-gray-400 uppercase tracking-wider mb-1">V√©rifications</div>
                            <div class="text-4xl font-black gradient-text" id="stat-checks">0</div>
                        </div>
                        <div class="stat-card p-5 rounded-xl">
                            <div class="text-xs text-gray-400 uppercase tracking-wider mb-1">Places d√©tect√©es</div>
                            <div class="text-4xl font-black text-green-400" id="stat-detections">0</div>
                        </div>
                        <div class="stat-card p-5 rounded-xl">
                            <div class="text-xs text-gray-400 uppercase tracking-wider mb-1">Temps r√©ponse</div>
                            <div class="text-4xl font-black" id="stat-response-time">0.8s</div>
                        </div>
                        <div class="stat-card p-5 rounded-xl">
                            <div class="text-xs text-gray-400 uppercase tracking-wider mb-1">Alertes envoy√©es</div>
                            <div class="text-4xl font-black text-cyan-400" id="stat-alerts">0</div>
                        </div>
                    </div>
                </div>

                <!-- M√©t√©o -->
                <div class="glass rounded-3xl p-6 slide-in" style="animation-delay: 0.3s">
                    <h3 class="text-xl font-black mb-6">M√©t√©o pr√©vue</h3>
                    <div class="text-center">
                        <div class="text-6xl mb-4" id="weather-emoji">üå§Ô∏è</div>
                        <div class="text-5xl font-black mb-2" id="weather-temp">8¬∞C</div>
                        <div class="text-sm text-gray-400 mb-6" id="weather-condition">Partiellement nuageux</div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-2xl mb-1">üíß</div>
                                <div class="font-bold" id="weather-rain">15%</div>
                                <div class="text-xs text-gray-400">Pluie</div>
                            </div>
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-2xl mb-1">üí®</div>
                                <div class="font-bold" id="weather-wind">12 km/h</div>
                                <div class="text-xs text-gray-400">Vent</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Composition PSG -->
                <div class="glass rounded-3xl p-6 slide-in" style="animation-delay: 0.4s">
                    <h3 class="text-xl font-black mb-6">Composition probable PSG</h3>
                    <div class="space-y-3 text-sm" id="lineup-psg">
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">GK</span>
                            <span class="font-semibold">Donnarumma</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">DF</span>
                            <span class="font-semibold leading-relaxed">Hakimi, Marquinhos, Skriniar, Mendes</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">MF</span>
                            <span class="font-semibold leading-relaxed">Vitinha, Ugarte, Za√Øre-Emery</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">FW</span>
                            <span class="font-semibold leading-relaxed">Demb√©l√©, Ramos, Barcola</span>
                        </div>
                    </div>
                </div>

                <!-- Composition OM -->
                <div class="glass rounded-3xl p-6 slide-in" style="animation-delay: 0.5s">
                    <h3 class="text-xl font-black mb-6">Composition probable OM</h3>
                    <div class="space-y-3 text-sm" id="lineup-away">
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">GK</span>
                            <span class="font-semibold">L√≥pez</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">DF</span>
                            <span class="font-semibold leading-relaxed">Clauss, Gigot, Balerdi, Tavares</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">MF</span>
                            <span class="font-semibold leading-relaxed">Rongier, Veretout, Harit</span>
                        </div>
                        <div class="flex items-start gap-3 glass p-3 rounded-lg">
                            <span class="font-mono text-gray-400 min-w-[28px]">FW</span>
                            <span class="font-semibold leading-relaxed">Aubameyang, Moumbagna, Greenwood</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA Telegram -->
        <div class="mt-8 gradient-bg border border-cyan-500/20 rounded-3xl p-10 text-center slide-in" style="animation-delay: 0.5s">
            <div class="text-5xl mb-4">üì±</div>
            <h3 class="text-3xl font-black gradient-text mb-3">Recevez une alerte instantan√©e</h3>
            <p class="text-gray-400 mb-6 max-w-2xl mx-auto">
                Notification Telegram en temps r√©el d√®s qu'une place PMR se lib√®re pour ce match
            </p>
            <a href="https://t.me/+yrZlOGj5wf4yMjg0" target="_blank" class="inline-flex items-center gap-3 bg-gradient-to-r from-cyan-500 to-green-500 hover:from-cyan-600 hover:to-green-600 text-black font-black px-10 py-5 rounded-xl transition-all transform hover:scale-105 text-lg">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                </svg>
                Rejoindre le canal
            </a>
        </div>
    </div>

    <script>
        // URL du bot
        const BOT_URL = 'https://app.lesbricolesdelekmane.fun';
        
        // R√©cup√©rer le nom du match depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const matchName = urlParams.get('match');
        
        if (!matchName) {
            // Rediriger vers la page d'accueil si pas de match sp√©cifi√©
            window.location.href = 'index.html';
        }
        
        let currentMatch = null;
        let groqIntervalId = null;
        
        // Charger les donn√©es du match
        async function chargerDonneesMatch(reloadGroq = true) {
            try {
                console.log('üîÑ Chargement des donn√©es pour:', matchName);
                console.log('üì° URL:', `${BOT_URL}/status.json`);
                
                const response = await fetch(`${BOT_URL}/status.json`);
                
                if (!response.ok) {
                    console.error('‚ùå Erreur HTTP:', response.status, response.statusText);
                    return;
                }
                
                const data = await response.json();
                console.log('‚úÖ Donn√©es re√ßues:', data);
                
                // Trouver le match correspondant
                const match = data.matchs.find(m => m.nom === matchName);
                
                if (!match) {
                    console.error('‚ùå Match non trouv√©:', matchName);
                    console.log('üìã Matchs disponibles:', data.matchs.map(m => m.nom));
                    // Match non trouv√©, rediriger
                    window.location.href = 'index.html';
                    return;
                }
                
                console.log('‚úÖ Match trouv√©:', match);
                currentMatch = match;
                
                // Charger l'historique des d√©tections
                chargerHistoriqueDetections(match.nom);
                
                // Mettre √† jour le titre
                const titleParts = match.nom.split(' vs ');
                const h1 = document.querySelector('h1');
                if (h1) {
                    h1.innerHTML = `
                        <span class="gradient-text">${titleParts[0]}</span>
                        <span class="text-gray-600 mx-3">vs</span>
                        <span class="gradient-text">${titleParts[1] || ''}</span>
                    `;
                }
                
                // Mettre √† jour le statut PMR
                const pmrCard = document.querySelector('.glass.rounded-2xl.p-6');
                if (pmrCard) {
                    // Chercher le statut PMR (peut avoir plusieurs classes)
                    const pmrStatus = pmrCard.querySelector('.text-3xl');
                    const pmrIcon = pmrCard.querySelector('.text-5xl');
                    const borderEl = pmrCard.querySelector('.border-l-4');
                    
                    if (match.pmr_disponible) {
                        if (pmrStatus) {
                            pmrStatus.textContent = 'Disponibles';
                            pmrStatus.className = 'text-3xl font-black text-green-400 mb-1';
                        }
                        if (pmrIcon) pmrIcon.textContent = '‚úÖ';
                        if (borderEl) {
                            borderEl.classList.remove('border-red-500', 'border-red-500/50');
                            borderEl.classList.add('border-green-500', 'border-green-500/50');
                        }
                    } else {
                        if (pmrStatus) {
                            pmrStatus.textContent = 'Aucune';
                            pmrStatus.className = 'text-3xl font-black text-red-400 mb-1';
                        }
                        if (pmrIcon) pmrIcon.textContent = '‚ùå';
                        if (borderEl) {
                            borderEl.classList.remove('border-green-500', 'border-green-500/50');
                            borderEl.classList.add('border-red-500', 'border-red-500/50');
                        }
                    }
                    
                    // Mettre √† jour le dernier check
                    const lastCheck = pmrCard.querySelector('.text-xs.text-gray-500');
                    if (lastCheck) {
                        lastCheck.textContent = `Derni√®re v√©rif: ${match.dernier_check}`;
                    }
                }
                
                // Mettre √† jour les stats monitoring
                const statChecks = document.getElementById('stat-checks');
                if (statChecks) statChecks.textContent = match.nb_checks.toLocaleString('fr-FR');
                
                const statDetections = document.getElementById('stat-detections');
                if (statDetections) {
                    // Pour l'instant, on met 1 si PMR disponible, 0 sinon
                    // Plus tard on pourra tracker le nombre r√©el de d√©tections
                    statDetections.textContent = match.pmr_disponible ? '1' : '0';
                }
                
                // Charger les stats globales pour les alertes
                fetch(`${BOT_URL}/status.json`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.statistiques) {
                            const statAlerts = document.getElementById('stat-alerts');
                            if (statAlerts) statAlerts.textContent = data.statistiques.alertes_envoyees || 0;
                        }
                    })
                    .catch(err => console.error('Erreur chargement stats:', err));
                
                // La comparaison sera mise √† jour par chargerAnalyseGroq()
                
                // Charger l'analyse Groq si demand√©
                if (reloadGroq) {
                    chargerAnalyseGroq(match);
                }
                
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
            }
        }
        
        // Charger l'analyse Groq compl√®te
        async function chargerAnalyseGroq(match) {
            try {
                console.log('üì° Appel API Groq pour:', match.nom);
                const url = `${BOT_URL}/api/groq/analyze?match=${encodeURIComponent(match.nom)}`;
                console.log('üîó URL:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.error('‚ùå Erreur HTTP analyse Groq:', response.status, response.statusText);
                    const errorText = await response.text();
                    console.error('üìÑ R√©ponse erreur:', errorText);
                    return;
                }
                
                const data = await response.json();
                console.log('‚úÖ Donn√©es Groq re√ßues:', data);
                
                // V√©rifier si c'est une erreur (string) ou des donn√©es avec error: true (fallback)
                if (data.error && typeof data.error === 'string') {
                    console.error('Erreur analyse Groq:', data.error);
                    return;
                }
                
                // Si error: true, ce sont des donn√©es par d√©faut, on les affiche quand m√™me
                
                // 1. Mettre √† jour l'analyse IA
                if (data.analysis) {
                    // Mettre √† jour le score de hype principal (le gros pourcentage)
                    const hypeLevel = document.querySelector('.text-7xl.gradient-text');
                    if (hypeLevel) {
                        hypeLevel.textContent = `${data.analysis.hype_score}%`;
                        console.log('‚úÖ Score hype mis √† jour:', data.analysis.hype_score);
                    } else {
                        console.warn('‚ö†Ô∏è √âl√©ment .text-7xl.gradient-text non trouv√©');
                    }
                    
                    // Mettre √† jour les cartes de statistiques
                    const statCards = document.querySelectorAll('.stat-card.p-6.rounded-2xl');
                    console.log('üìä Nombre de cartes trouv√©es:', statCards.length);
                    
                    // Carte 0 : Label "Tr√®s √©lev√©/√âlev√©" (Hype social)
                    if (statCards.length >= 1) {
                        const hypeLabelCard = statCards[0];
                        const hypeLabel = hypeLabelCard.querySelector('.text-2xl.font-bold');
                        if (hypeLabel) {
                            const score = data.analysis.hype_score;
                            const label = score >= 90 ? 'Tr√®s √©lev√©' : score >= 75 ? '√âlev√©' : score >= 60 ? 'Moyen' : 'Faible';
                            hypeLabel.textContent = label;
                            console.log('‚úÖ Label hype mis √† jour:', label);
                        } else {
                            console.warn('‚ö†Ô∏è √âl√©ment .text-2xl.font-bold non trouv√© dans statCards[0]');
                        }
                    }
                    
                    // Carte 1 : Affluence pr√©vue
                    if (statCards.length >= 2) {
                        const affluenceCard = statCards[1];
                        const affluenceEl = affluenceCard.querySelector('.text-2xl.font-bold');
                        if (affluenceEl) {
                            affluenceEl.textContent = `${data.analysis.affluence_prevue}%`;
                            console.log('‚úÖ Affluence mise √† jour:', data.analysis.affluence_prevue);
                        } else {
                            console.warn('‚ö†Ô∏è √âl√©ment .text-2xl.font-bold non trouv√© dans statCards[1]');
                        }
                    } else {
                        console.warn('‚ö†Ô∏è Pas assez de cartes trouv√©es (besoin de 2, trouv√©:', statCards.length);
                    }
                    
                    const analyseText = document.querySelector('.text-gray-300.leading-relaxed');
                    if (analyseText) {
                        let analyseHTML = data.analysis.analyse;
                        if (data.analysis.probabilite_pmr !== undefined) {
                            analyseHTML = analyseHTML.replace(
                                new RegExp(`(${data.analysis.probabilite_pmr}%)`, 'g'),
                                `<span class="text-white font-semibold">${data.analysis.probabilite_pmr}%</span>`
                            );
                        }
                        analyseText.innerHTML = analyseHTML;
                    }
                }
                
                // 2. Mettre √† jour la comparaison (avec vrais noms de matchs)
                if (data.comparison) {
                    updateComparison(data.comparison, match.nom);
                }
                
                // 3. Mettre √† jour la m√©t√©o
                if (data.weather) {
                    updateWeather(data.weather);
                }
                
                // 4. Mettre √† jour les compositions
                if (data.lineups) {
                    const teams = match.nom.split(' vs ');
                    updateLineups(data.lineups, teams[0], teams[1] || 'Adversaire');
                }
                
                console.log('‚úÖ Analyse Groq mise √† jour avec succ√®s');
                
            } catch (error) {
                console.error('‚ùå Erreur chargement analyse Groq:', error);
                console.error('üìã D√©tails:', error.message, error.stack);
            }
        }
        
        // Charger l'historique des d√©tections PMR
        async function chargerHistoriqueDetections(matchNom) {
            try {
                const response = await fetch(`${BOT_URL}/api/detections-history?match=${encodeURIComponent(matchNom)}`);
                if (!response.ok) {
                    console.error('Erreur chargement historique:', response.status);
                    return;
                }
                
                const historique = await response.json();
                const container = document.getElementById('detections-history');
                
                if (!container) return;
                
                if (historique.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-4xl mb-2">üì≠</div>
                            <div>Aucune d√©tection PMR enregistr√©e pour ce match</div>
                        </div>
                    `;
                    return;
                }
                
                // Trier par date (plus r√©cent en premier)
                historique.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                container.innerHTML = historique.map(detection => {
                    const date = new Date(detection.date);
                    const dateStr = date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    const timeStr = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                    
                    return `
                        <div class="glass p-5 rounded-xl border-l-4 border-green-400">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">‚úÖ</span>
                                    <div>
                                        <div class="font-bold">Place${detection.nb_places > 1 ? 's' : ''} PMR d√©tect√©e${detection.nb_places > 1 ? 's' : ''}</div>
                                        <div class="text-sm text-gray-400">${detection.nb_places} place${detection.nb_places > 1 ? 's' : ''} disponible${detection.nb_places > 1 ? 's' : ''}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-semibold">${dateStr}</div>
                                    <div class="text-xs text-gray-400">${timeStr}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Erreur chargement historique d√©tections:', error);
                const container = document.getElementById('detections-history');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center text-red-400 py-8">
                            <div class="text-4xl mb-2">‚ùå</div>
                            <div>Erreur lors du chargement de l'historique</div>
                        </div>
                    `;
                }
            }
        }
        
        // Mettre √† jour la comparaison avec vrais noms de matchs
        function updateComparison(comparison, matchName) {
            // Extraire le match actuel
            const currentScore = comparison.current_match;
            
            // Extraire les autres matchs dynamiquement (format: match_1, match_2, etc.)
            const otherMatches = [];
            let i = 1;
            while (comparison[`match_${i}`] !== undefined) {
                const matchNameKey = comparison[`match_${i}_name`] || `Match ${i}`;
                otherMatches.push({
                    name: matchNameKey,
                    score: comparison[`match_${i}`]
                });
                i++;
            }
            
            // Si pas de matchs avec format match_X, essayer les anciennes cl√©s (psg_lyon, etc.)
            if (otherMatches.length === 0) {
                const comparisonKeys = Object.keys(comparison).filter(k => 
                    k !== 'current_match' && !k.endsWith('_name')
                );
                
                otherMatches.push(...comparisonKeys.map(key => {
                    // Utiliser le nom si disponible
                    const nameKey = `${key}_name`;
                    if (comparison[nameKey]) {
                        return {
                            name: comparison[nameKey],
                            score: comparison[key]
                        };
                    }
                    
                    // Sinon convertir "psg_lyon" en "PSG vs Lyon"
                    const parts = key.split('_');
                    const home = parts[0].toUpperCase();
                    const away = parts[1] ? parts[1].charAt(0).toUpperCase() + parts[1].slice(1) : 'Adversaire';
                    return {
                        name: `${home} vs ${away}`,
                        score: comparison[key]
                    };
                }));
            }
            
            // Construire l'affichage
            const allComparisons = [
                { 
                    name: matchName, 
                    score: currentScore,
                    isCurrent: true 
                },
                ...otherMatches.map(m => ({
                    name: m.name,
                    score: m.score,
                    isCurrent: false
                }))
            ];
            
            const container = document.querySelector('.comparison-container') || 
                             document.querySelector('.glass.rounded-3xl.p-8 .space-y-4');
            
            if (container) {
                container.innerHTML = allComparisons.map((comp, i) => `
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold ${comp.isCurrent ? 'text-white' : ''}">${comp.name}</span>
                            <span class="font-black ${comp.isCurrent ? 'text-cyan-400' : ''}">${comp.score}%</span>
                        </div>
                        <div class="h-3 bg-white/5 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-${comp.isCurrent ? 'cyan' : 'blue'}-500 to-${comp.isCurrent ? 'green' : 'purple'}-500" 
                                 style="width: ${comp.score}%"></div>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // Mettre √† jour la m√©t√©o
        function updateWeather(weather) {
            const emojiEl = document.getElementById('weather-emoji');
            const tempEl = document.getElementById('weather-temp');
            const conditionEl = document.getElementById('weather-condition');
            const rainEl = document.getElementById('weather-rain');
            const windEl = document.getElementById('weather-wind');
            
            if (emojiEl) emojiEl.textContent = weather.emoji;
            if (tempEl) tempEl.textContent = `${weather.temperature}¬∞C`;
            if (conditionEl) conditionEl.textContent = weather.condition;
            if (rainEl) rainEl.textContent = `${weather.rain_chance}%`;
            if (windEl) windEl.textContent = `${weather.wind_speed} km/h`;
        }
        
        // Mettre √† jour les compositions
        function updateLineups(lineups, homeTeam, awayTeam) {
            // Mettre √† jour la composition PSG
            const psgLineup = lineups.home;
            const psgContainer = document.getElementById('lineup-psg');
            
            if (psgContainer && psgLineup) {
                const positions = [
                    { code: 'GK', players: psgLineup.gk },
                    { code: 'DF', players: psgLineup.df },
                    { code: 'MF', players: psgLineup.mf },
                    { code: 'FW', players: psgLineup.fw }
                ];
                
                psgContainer.innerHTML = positions.map(pos => `
                    <div class="flex items-start gap-3 glass p-3 rounded-lg">
                        <span class="font-mono text-gray-400 min-w-[28px]">${pos.code}</span>
                        <span class="font-semibold leading-relaxed">${pos.players.join(', ')}</span>
                    </div>
                `).join('');
            }
            
            // Mettre √† jour la composition adverse
            const awayLineup = lineups.away;
            const awayContainer = document.getElementById('lineup-away');
            
            if (awayContainer && awayLineup) {
                const positions = [
                    { code: 'GK', players: awayLineup.gk },
                    { code: 'DF', players: awayLineup.df },
                    { code: 'MF', players: awayLineup.mf },
                    { code: 'FW', players: awayLineup.fw }
                ];
                
                awayContainer.innerHTML = positions.map(pos => `
                    <div class="flex items-start gap-3 glass p-3 rounded-lg">
                        <span class="font-mono text-gray-400 min-w-[28px]">${pos.code}</span>
                        <span class="font-semibold leading-relaxed">${pos.players.join(', ')}</span>
                    </div>
                `).join('');
            }
        }
        
        // Fonction pour d√©terminer si c'est le jour du match
        function estJourDuMatch(match) {
            // TODO: Impl√©menter la d√©tection du jour du match
            // Pour l'instant, on retourne false par d√©faut
            // On pourrait ajouter une date dans matches.json ou status.json
            return false;
        }
        
        // G√©rer l'analyse Groq avec la bonne fr√©quence
        function gererAnalyseGroq(match) {
            // Nettoyer l'intervalle pr√©c√©dent si existe
            if (groqIntervalId) {
                clearInterval(groqIntervalId);
            }
            
            const estAujourdhui = estJourDuMatch(match);
            const intervalle = estAujourdhui ? 600000 : 18000000; // 10 min ou 5 heures
            
            // Charger imm√©diatement
            chargerAnalyseGroq(match);
            
            // Puis recharger selon l'intervalle
            groqIntervalId = setInterval(() => {
                chargerAnalyseGroq(match);
                // Re-v√©rifier si on est toujours le jour du match
                const nouvelleEstAujourdhui = estJourDuMatch(match);
                if (nouvelleEstAujourdhui !== estAujourdhui) {
                    // Relancer avec le nouvel intervalle
                    gererAnalyseGroq(match);
                }
            }, intervalle);
        }
        
        // Mettre √† jour le graphique
        function updateChart(matchData) {
            const canvas = document.getElementById('checkChart');
            if (!canvas) return;
            
            // Si pas assez de donn√©es, masquer le graphique
            if (!matchData || matchData.nb_checks < 7) {
                canvas.parentElement.style.display = 'none';
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) return;
            
            // D√©truire tout graphique existant
            if (window.myChart) {
                window.myChart.destroy();
            }
            
            // Cr√©er des donn√©es basiques (on peut am√©liorer √ßa plus tard avec un vrai historique)
            const labels = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
            // R√©partir les v√©rifications sur 7 jours (approximation)
            const checksPerDay = Math.floor(matchData.nb_checks / 7);
            const data = labels.map(() => checksPerDay + Math.floor(Math.random() * 20));
            
            // Cr√©er le nouveau graphique
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'V√©rifications',
                        data: data,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1000
                    },
                    plugins: {
                        legend: { 
                            display: false 
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { 
                                color: 'rgba(255,255,255,0.05)',
                                drawBorder: false
                            },
                            ticks: { 
                                color: '#666',
                                padding: 10
                            }
                        },
                        x: {
                            grid: { 
                                color: 'rgba(255,255,255,0.05)',
                                drawBorder: false
                            },
                            ticks: { 
                                color: '#666',
                                padding: 10
                            }
                        }
                    }
                }
            });
        }
        
        // Charger au d√©marrage
        console.log('üöÄ Initialisation de more.html');
        console.log('üìù Match recherch√©:', matchName);
        
        let reloadIntervalId = null;
        
        chargerDonneesMatch().then(() => {
            if (currentMatch) {
                console.log('üìä Mise √† jour du graphique');
                updateChart(currentMatch);
                console.log('ü§ñ D√©marrage de l\'analyse Groq');
                gererAnalyseGroq(currentMatch);
            } else {
                console.error('‚ùå Aucun match charg√©');
            }
        }).catch(error => {
            console.error('‚ùå Erreur lors du chargement initial:', error);
        });
        
        // Recharger les donn√©es toutes les 10 secondes (sans l'analyse Groq)
        // Nettoyer l'intervalle pr√©c√©dent si la page est recharg√©e
        if (reloadIntervalId) {
            clearInterval(reloadIntervalId);
        }
        reloadIntervalId = setInterval(() => {
            console.log('üîÑ Rechargement p√©riodique des donn√©es (sans Groq)');
            chargerDonneesMatch(false);
        }, 10000);
    </script>
</body>
</html>